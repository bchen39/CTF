Even though bound check is implemented, the casting to short and then to ulong could result in an integer overflow vulnerability. The int 32768 (0x8000) is a negative number (0x8000) if casted as short, thus will bypass the bound check yet still cause fread to take in 32768 bytes as input since it's now a ulong. Afterwards I could also bypass the canary by overwriting the function pointer with that of leave; ret; instructions, skipping the canary check entirely. Then I bypass NX through ROP by putting the right values in the right registers in order to execute setreuid and execv('/bin/sh'). Please see my code for details.
